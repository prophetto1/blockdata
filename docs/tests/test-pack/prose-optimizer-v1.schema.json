{
  "$id": "urn:writing-system:annotation-schema:prose_optimizer_v1",
  "title": "Prose Optimizer v1 (per-block)",
  "description": "User-defined annotation schema. The AI reads immutable.content.original and appends the rewritten block under annotation.data.final.content. Immutable is never modified.",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "action": {
      "type": "string",
      "enum": ["keep", "rewrite", "skip_nonprose"],
      "description": "What to do with this block."
    },
    "final": {
      "type": "object",
      "additionalProperties": false,
      "description": "Appended final version of the block. This is the only place the rewritten block content lives.",
      "properties": {
        "content": {
          "type": "string",
          "description": "Final block content as a Markdown fragment."
        },
        "format": {
          "type": "string",
          "enum": ["markdown_fragment"],
          "default": "markdown_fragment"
        }
      },
      "required": ["content"]
    },
    "checks": {
      "type": "array",
      "maxItems": 3,
      "description": "A small set of prose-optimizer checks applied to this block (examples: active_voice, omit_needless_words, concrete_language).",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "rule_id": {
            "type": "string",
            "description": "Short stable identifier (e.g., active_voice, omit_needless_words)."
          },
          "verdict": {
            "type": "string",
            "enum": ["pass", "fix_applied", "not_applicable", "flagged"]
          },
          "notes": {
            "type": "string",
            "maxLength": 300
          }
        },
        "required": ["rule_id", "verdict"]
      }
    },
    "diff_summary": {
      "type": "string",
      "maxLength": 400,
      "description": "Short summary of what changed and why."
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Confidence that final.content is an improvement and preserves meaning."
    }
  },
  "required": ["action", "final"]
}

